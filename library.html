<!DOCTYPE html>
<html>
  <head>
    <link href="styles.css" rel="stylesheet" type="text/css" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LB - Library</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
  </head>
  <body>
    <div class="website">
      <h1 style="text-align: center"><a href="index.html" style="text-decoration: none; color: inherit;">LB</a></h1>
      <div class="topnav">
        <a class="active" href="library.html">Library</a>
        <a href="index.html#history">History</a>
        <a href="index.html#teaching">Teaching</a>
      </div>
      <div class="main-section-container">
        <div class="main-section">
          <button class="collapsible">Literature</button>
          <div class="content">
            <table class="library-table" data-section="literature">
              <thead>
                <tr>
                  <th data-sort="date">Date <span class="sort-icon"></span></th>
                  <th data-sort="author">Author <span class="sort-icon"></span></th>
                  <th data-sort="title">Title <span class="sort-icon"></span></th>
                </tr>
              </thead>
              <tbody id="literature-body">
                <!-- Data will be loaded here -->
              </tbody>
            </table>
          </div>

          <button class="collapsible">Cinema</button>
          <div class="content">
            <table class="library-table" data-section="cinema">
              <thead>
                <tr>
                  <th data-sort="date">Date <span class="sort-icon"></span></th>
                  <th data-sort="director">Director <span class="sort-icon"></span></th>
                  <th data-sort="title">Title <span class="sort-icon"></span></th>
                  <th data-sort="rating">Rating <span class="sort-icon"></span></th>
                </tr>
              </thead>
              <tbody id="cinema-body">
                <!-- Data will be loaded here -->
              </tbody>
            </table>
          </div>

          <button class="collapsible">Music</button>
          <div class="content">
            <table class="library-table" data-section="music">
              <thead>
                <tr>
                  <th data-sort="date">Date <span class="sort-icon"></span></th>
                  <th data-sort="artist">Artist <span class="sort-icon"></span></th>
                  <th data-sort="title">Title <span class="sort-icon"></span></th>
                </tr>
              </thead>
              <tbody id="music-body">
                <!-- Data will be loaded here -->
              </tbody>
            </table>
          </div>

          <button class="collapsible">Art</button>
          <div class="content">
            <table class="library-table" data-section="art">
              <thead>
                <tr>
                  <th data-sort="date">Date <span class="sort-icon"></span></th>
                  <th data-sort="artist">Artist <span class="sort-icon"></span></th>
                  <th data-sort="title">Title <span class="sort-icon"></span></th>
                </tr>
              </thead>
              <tbody>
                <!-- Add your art items here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      const SHEET_ID = '1VRTZ7u2ZsgtICWkA9w0b7uXRWAKEcyxXrv3lsKxLg8g';
      const SHEETS = {
        literature: 'Literature',
        cinema: 'Cinema',
        music: 'Music'
      };

      async function loadSheetData(sheetName) {
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`;
        try {
          const response = await fetch(url);
          const csvText = await response.text();
          const data = Papa.parse(csvText, { header: true }).data;
          
          // Filter out empty rows and get the correct section
          let sectionData = [];
          let inCorrectSection = false;
          
          for (const row of data) {
            if (row.Date === sheetName) {
              inCorrectSection = true;
              continue;
            }
            if (inCorrectSection && (row.Date === 'Cinema' || row.Date === 'Music' || row.Date === 'Literature')) {
              break;
            }
            if (inCorrectSection && (row.Date || row.Title)) {
              sectionData.push(row);
            }
          }
          
          return sectionData;
        } catch (error) {
          console.error(`Error loading ${sheetName} data:`, error);
          return [];
        }
      }

      function createTableRow(data, section) {
        const row = document.createElement('tr');
        
        if (section === 'cinema') {
          row.innerHTML = `
            <td>${data.Date || ''}</td>
            <td>${data.Director || ''}</td>
            <td>${data.Title || ''}</td>
            <td>${data.Rating || ''}</td>
          `;
        } else {
          row.innerHTML = `
            <td>${data.Date || ''}</td>
            <td>${data.Author || data.Artist || ''}</td>
            <td>${data.Title || ''}</td>
          `;
        }
        
        return row;
      }

      async function loadAllData() {
        for (const [section, sheetName] of Object.entries(SHEETS)) {
          const data = await loadSheetData(sheetName);
          const tbody = document.getElementById(`${section}-body`);
          if (tbody) {
            tbody.innerHTML = '';
            data.forEach(row => {
              if (row.Date || row.Title) { // Only add rows that have at least a date or title
                tbody.appendChild(createTableRow(row, section));
              }
            });
          }
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        // Load data
        loadAllData();

        // Collapsible functionality
        const collapsibles = document.getElementsByClassName("collapsible");
        for (let i = 0; i < collapsibles.length; i++) {
          // Set initial state to collapsed
          collapsibles[i].classList.add("collapsed");
          const content = collapsibles[i].nextElementSibling;
          content.classList.add("collapsed");
          
          collapsibles[i].addEventListener("click", function() {
            this.classList.toggle("collapsed");
            const content = this.nextElementSibling;
            content.classList.toggle("collapsed");
          });
        }

        // Table sorting functionality
        const tables = document.getElementsByClassName("library-table");
        for (let table of tables) {
          const headers = table.getElementsByTagName("th");
          for (let header of headers) {
            header.addEventListener("click", function() {
              const sortBy = this.getAttribute("data-sort");
              const tbody = table.getElementsByTagName("tbody")[0];
              const rows = Array.from(tbody.getElementsByTagName("tr"));
              
              // Remove sort classes from all headers
              Array.from(headers).forEach(h => {
                h.classList.remove("sort-asc", "sort-desc");
              });

              // Determine sort direction
              const isAsc = !this.classList.contains("sort-asc");
              this.classList.toggle("sort-asc", isAsc);
              this.classList.toggle("sort-desc", !isAsc);

              // Sort rows
              rows.sort((a, b) => {
                const aValue = a.getElementsByTagName("td")[Array.from(headers).indexOf(this)].textContent;
                const bValue = b.getElementsByTagName("td")[Array.from(headers).indexOf(this)].textContent;
                
                if (sortBy === "date") {
                  // Sort dates
                  return isAsc ? new Date(aValue) - new Date(bValue) : new Date(bValue) - new Date(aValue);
                } else if (sortBy === "rating") {
                  // Sort ratings numerically
                  return isAsc ? (parseFloat(aValue) || 0) - (parseFloat(bValue) || 0) : (parseFloat(bValue) || 0) - (parseFloat(aValue) || 0);
                } else {
                  // Sort text
                  return isAsc ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
                }
              });

              // Reorder rows
              rows.forEach(row => tbody.appendChild(row));
            });
          }
        }
      });
    </script>
  </body>
</html> 